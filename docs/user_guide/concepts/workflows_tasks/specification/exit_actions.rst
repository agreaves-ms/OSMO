..
  SPDX-FileCopyrightText: Copyright (c) 2025 NVIDIA CORPORATION & AFFILIATES. All rights reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  SPDX-License-Identifier: Apache-2.0

.. _concepts_wf_actions:

============
Exit Actions
============

You can define task actions based on the **exit code** for every task in a workflow.
Supported actions are:

..  list-table::
  :header-rows: 1
  :widths: auto

  * - **Action**
    - **Description**
  * - COMPLETE
    - Task will be marked as COMPLETED.
  * - FAIL
    - Task will be marked as FAILED.
  * - RESCHEDULE
    - Task will be marked as RESCHEDULED and the same task with an incremented retry ID
      will be scheduled. If you want all other tasks in the same group to be restarted,
      please set ``ignoreNonleadStatus`` to ``false`` for the group (see :ref:`concepts_groups`).

.. note::

  The default configuration for exit actions are to mark the task as ``COMPLETED`` when the exit
  code is ``0``. If the task is preempted, mark the task as ``RESCHEDULED``.
  Otherwise, mark the task as ``FAIL``.

An example of how you can define exit actions is shown in the following example.
Exit codes have the format as ``start1-end1,num2,...``.

.. code-block:: yaml

  workflow:
    name: exit-actions-example
    tasks:
    - name: example
      image: ubuntu
      command: [/bin/sh]
      args: [/tmp/run.sh]
      files:
      - contents: |
          echo hello
          exit 16
        path: /tmp/run.sh

      exitActions:
        COMPLETE: 0,1-10,16,20 # (1)

.. code-annotations::

  1. The task will be marked as ``COMPLETED`` when the exit code is ``0``, between ``1-10`` (inclusive), ``16``, or ``20``.

The task above will return exit code as ``16`` and based on the actions the task will have status
as ``COMPLETED``.

.. note::

  * Make sure there is no overlapping between exit codes for different actions.
  * Exit codes generated by the task should be no greater than ``255`` as higher exit codes are reserved for OSMO.

The following example shows how user can reschedule a task based on its exit codes.

.. code-block:: yaml

  workflow:
    name: exit-actions-example
    tasks:
    - name: example
      image: ubuntu
      command: [/bin/sh]
      args: [/tmp/run.sh]
      files:
      - contents: |
          echo hello
          exit 16
        path: /tmp/run.sh

      exitActions:
        COMPLETE: 0-10
        RESCHEDULE: 11-20 # (1)

.. code-annotations::

  1. The task will be marked as ``RESCHEDULED`` since the exit code is 16 and it falls into the range ``11-20``.

You can access details about rescheduled tasks by setting the ``verbose`` flag:

.. code-block:: bash
  :substitutions:

  $ osmo workflow query <workflow_id> --verbose
